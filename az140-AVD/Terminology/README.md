# Terminology

---

## URL
|n|Name|Img|
|-|----|---|
|1|[how-msix-app-attach-works](https://learn.microsoft.com/en-us/training/modules/install-configure-apps-session-host/3-how-msix-app-attach-works)|
|2|[Learning Path](https://learn.microsoft.com/en-us/training/browse/?terms=az-140)
|3|[Remote Desktop Protocol (RDP) bandwidth requirements](https://learn.microsoft.com/en-us/azure/virtual-desktop/rdp-bandwidth)|<img src="https://i.imgur.com/Kh1Po4a.png">|
|4|[instance-metadata-service](https://learn.microsoft.com/en-us/azure/virtual-machines/instance-metadata-service?tabs=windows)
|5|[Test framerates](https://testufo.com)|AVD Web:<br/><img src="https://i.imgur.com/bMTOae3.png"> |

---

## Acronym
|n|Name|Desc.|
|-|----|-----|
|1|aka|Also Known As|
|2|DR|Disaster Recovery|
|3|HPC|High-Performance Compute|HPC infrastructure & apps|
|4|IOPs|Input/output operations per second|
|5|IMDS|Instance Metadata Service|
|6|NSG|Network Security Group|
|7|ODFC|Office Data Folder Container (FSLogix)|
|8|RDSH|Remote Desktop Session Host|
|9|VDI|Virtual Desktop Infrastructures|
|10|vhd|virtual Hard Drive|
|11|VHDx|Hyper-V Virtual Hard Disk|

---

## List
|n|name|Desc.|img|e.g.|
|-|----|-----|---|----|
|1|AVD Client<details><summary>Toubleshoot</summary>Reset the user data:<br/>`msrdcw.exe /reset [/f]`<br/><br/>Web client won't open<br/>checkUp DNS:<br/>`nslookup rdweb.wvd.microsoft.com`</details>|
|2|AVD Network Connections<details><summary>RDP ShortPath</summary>establishes a UDP-based transport between a Remote Desktop client & session host (it's a feature more speed on UPD vs TCP)<br/><br/>`New-ItemProperty  "HKLM:\system\currentControlSet\control\terminal server\winStations" -Name "fUseUdpPortRedirector" -PropertyType DWord -Value 1`<br/><br/>`New-ItemProperty  "HKLM:\system\currentControlSet\control\terminal server\winStations" -Name "UdpPortNumber" -PropertyType DWord -Value 3390`<br/><br/><img src="https://i.imgur.com/gKkW6XY.png"><br/><br/>New Inbound rule<br/>program path: `%systemRoot%\system32\svchost.exe`<br/><img src="https://i.imgur.com/ylwrOdP.png"><br/>Protocol type: UDP<br/>Local port-Specific Ports: 3390<br/><img src="https://i.imgur.com/eeyqnP2.png"><br/>Name: RDP ShortPath-UDP 3390<br/><br/><img src="https://i.imgur.com/Omogwfu.png"><br/>go to the properties of our new rule inbound:<br/>onglet-Programs-&-Service-click-Settings<br/><img src="https://i.imgur.com/qtxUJ5N.png"><br/>Appl y to this service: Remote Desktop Sevice:<br/><img src="https://i.imgur.com/c4mIORO.png"><br/>allow from our network security group(NSG)<br/><img src="https://i.imgur.com/ccXvPCX.png"><br/>test after reboot client:<br/><img src="https://i.imgur.com/CzArbKk.png"><br/>Optional-checkUp-eventViewer:<br/><img src="https://i.imgur.com/1ZnbDj4.png"><br/>we can too checkup side from server via Log Analystics workspace via query WDConnections-UdpUse<br/><img src="https://i.imgur.com/EGV5fBO.png"><br/>Policy-based QoS(GPM.msc):<br/><img src="https://i.imgur.com/8ovRqdg.png"><br/>Only apps with this executable name : svchost.exe:<br/><img src="https://i.imgur.com/3UKCBEz.png"><br/>Protocol : UDP & source port : 3390<br/><br/><img src="https://i.imgur.com/6d3BRmK.png"></details>||<img src="https://i.imgur.com/ShTV88k.png">|
|3|Application group<details><summary>Limits</summary>1. 50 Apps per App Group Limit<br/><br/>2. 200 App Groups Per AAD Tenant</details><details><summary>Workspace</summary>App Group associate to a workspace</details>|
|4|Azure File Sync||<img src="https://i.imgur.com/kP8JKI1.png">|
|5|Azure Image Builder (similar to TaskSequence)||
|6|Azure NetApp Files|aka DFS|Overview:<br/><img src="https://i.imgur.com/KmQm0fU.png"><br/><br/>ANF-FSLogix:<br/><img src="https://i.imgur.com/Zs1NoT0.png"><br/><br/>Previous ver:<br/><img src="https://i.imgur.com/XN9Rh2Y.png">|
|7|Backup vaults & Recovery Services vaults|
|8|FSLogix profile containers<details><summary>Profile Status<br/></summary><img src="https://i.imgur.com/rudk28D.png"></details><details><summary>Office Container</summary>a subset of Profile Container</details><details><summary>ODFC (reg)</summary><img src="https://i.imgur.com/GhVknw2.png"></details><details><summary>OneDrive\Exclude profile solution(reg)</summary>`HKLM\Software\FSLogix\Logging\LoggingEnabled = 2`<br/><img src="https://i.imgur.com/VPxuxI1.png"></details><details><summary>FsLogix App masking</summary>This allows you to install all of your apps into your image & then control what apps your individual users are allowed to see</details><details><summary>Application Rules Editor</summary>FSLogix Apps RuleEditor:<br/><img src="https://i.imgur.com/JpRoS0J.png"></details><details><summary>fxa & fxr files</summary>Rules.fxa for all the assignments are & Rules.fxr for rules file itself:<br/><img src="https://i.imgur.com/Jkb5oNX.png"><br/>Assignments:<br/><img src="https://i.imgur.com/fE1J0Wa.png"><br/>GPM.msc:<br/><img src="https://i.imgur.com/jZ58jR0.png"></details><details><summary>VHDLocation vs Cloud Cache</summary><ins>VHDLocation</ins><br/>Only one active profile location<br/>`HKLM:\Software\FsLogix\Profiles`<br/><img src="https://i.imgur.com/fvFirKE.png"><br/><br/><ins>Cloud Cache</ins><br/></details>||
|9|Load balancing<details><summary>Breadth First</summary>To evenly distribute new user sessions across the session hosts in a host pool</details><details><summary>Depth First</summary>Starting new user sessions on one session host until the maximum session limit is reached.Once the session limit is reached, any new user connections are directed to the next session host in the host pool until it reaches its session limit, and so on</details><details><summary>Persistent</summary>Configured to direct requests from the same client to the same desktop every time that client connects</details>|
|10|msix app attach<br/><br/><details><summary>Optimize msix app attach performance</summary>The storage solution you use for MSIX app attach should be in the same datacenter location as the session hosts<br/>To avoid performance bottlenecks, exclude the following VHD, VHDX, and CIM files from antivirus scans:<br/><br/>`<MSIXAppAttachFileShare\>\*.VHD`<br/>`<MSIXAppAttachFileShare\>\*.VHDX`<br/>`\\storageaccount.file.core.windows.net\share*.VHD`<br/>`\\storageaccount.file.core.windows.net\share*.VHDX`<br/>`<MSIXAppAttachFileShare>.CIM`<br/>`\\storageaccount.file.core.windows.net\share**.CIM`<br/><br/>All VM system accounts and user accounts must have read-only permissions to access the file share<br/>Any disaster recovery plans for Azure Virtual Desktop must include replicating the MSIX app attach file share in your secondary failover location</details><details><summary>Selft-Signed Cert</summary>Put the cert into Trusted Poeple:<br/><img src="https://i.imgur.com/6sz1qbD.png"><br/>we can re-import self-signed cert if missing:<br/><img src="https://i.imgur.com/oNpsCj6.png"><br/><img src="https://i.imgur.com/jgT1YCT.png"></details><details><summary>.vhdx vs .cim (new & better files for the mount)</summary>vlc.vhdx<br/><br/><img src="https://i.imgur.com/m03SIFr.png"><br/><br/>vlc.cim:<br/><img src="https://i.imgur.com/fhWfCzV.png"></details>|app streaming (parent of app-v5.x)|<img src="https://i.imgur.com/TCmAj4T.png"><br/><ins>how-msix-app-attach-work (mount userProfile & app attach vhd):</ins><br/><img src="https://i.imgur.com/HFqZ0xT.png">||
|11|MSIX images|
|12|multi-session<br/><details><summary>Teams Desktop</summary>Install the app on your w10 multi-session<br/>`msiexec /i <path_to_msi> /l*v <install_logfile_name> ALLUSER=1 /noRestart /q`<br/><br/>`New-ItemProperty "HKLM:\SOFTWARE\Microsoft\Teams" -Name "IsAVDEnvironment" -PropertyType DWord -Value 1`</details><details><summary>Remote Desktop WebRTC Redirector Service</summary>[msi](https://learn.microsoft.com/en-us/training/modules/install-configure-apps-session-host/8-microsoft-teams-azure-virtual-desktop#:~:text=Remote%20Desktop%20WebRTC%20Redirector%20Service)<br/><img src="https://i.imgur.com/o3znvBk.png"><br/>checkUp if Teams for AVD is Optimized:<br/><img src="https://i.imgur.com/bNpsuIL.png"></details>||
|13|Publish built-in apps<br/><details><summary>default:</summary>`New-AzWvdApplication -Name <applicationname> -ResourceGroupName <resourcegroupname> -ApplicationGroupName <appgroupname> -FilePath "shell:appsFolder\<PackageFamilyName>!App" -CommandLineSetting <Allow\|Require\|DoNotAllow> -IconIndex 0 -IconPath <iconpath> -ShowInPortal:$true`</details><details><summary>MS Edge is a little different...:</summary>`New-AzWvdApplication -Name -ResourceGroupName -ApplicationGroupName -FilePath "shell:Appsfolder\Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge" -CommandLineSetting <Allow\|Require\|DoNotAllow> -iconPath "C:\Windows\SystemApps\Microsoft.MicrosoftEdge_8wekyb3d8bbwe\microsoftedge.exe" -iconIndex 0 -ShowInPortal:$true`</details>|
|15|NSG<details><summary>Inbound</summary>1. Allow_on_prem_hub (ping reciproque avd <> PhysicalDevice<br/><br/>2. Allow KMS<br/>Port: 1688<br/>Proto: Any<br/>SRC: vnet<br/>DST: 23.102.135.246<br/><br/>3. Allow_Metadata_health<br/>Port: 80<br/>Proto: TCP<br/>SRC: vnet<br/>DST: 169.254.169.254, 168.63.129.16</details><details><summary>metadata-service</summary>`Invoke-RestMethod -Headers @{"Metadata"="true"} -Method GET -NoProxy -Uri "http://169.254.169.254/metadata/instance?api-version=2021-02-01" \| ConvertTo-Json -Depth 64`<br/><br/>OutPut (e.g.):<br/><img src="https://i.imgur.com/6Xd0cH2.png"><br/><br/>Filter-NIC<br/>`Invoke-RestMethod -Headers @{"Metadata"="true"} -Method GET  -Uri "http://169.254.169.254/metadata/instance/network/interface/0?api-version=2021-02-01" \| ConvertTo-Json -Depth 64`<br/><br/>Output:<br/><img src="https://i.imgur.com/W8gwEHj.png"></details>||<img src="https://i.imgur.com/PWSEvJW.png">|
|16|Performance Monitor<details><summary>RemoteFX Graphics</summary>AVD web:<br/><img src="https://i.imgur.com/VFnUJRd.png"><br/><img src="https://i.imgur.com/2pY3rZo.png"></details>||
|17|Start VM On Connect|Starts a VM when a user initiates a connection to it. This ensures that the VM is powered on and ready for use as soon as a user attempts to access it, reducing wait times and improving user experience|
|18|Universal Print<details><summary>Universal Print connector (register for printers)</summary><img src="https://i.imgur.com/REMwX01.png"><br/>Register a printer:<br/><img src="https://i.imgur.com/bTo7Qxq.png"></details>|<img src="https://i.imgur.com/dVU3z2h.png">|
|19|User Profile|Contains data eleements about an individual, including cfg information like desktop settings, persisten network connections, & app settings|
|20|VHD Locations<details><summary>User Profile vhdx(reg)</summary><img src="https://i.imgur.com/BhSeUA5.png"></details><details><summary>FSLogix\SID\VHDX file</summary><img src="https://i.imgur.com/LOkktcu.png"></details><details><summary>Cloud Cache for SMB(reg)</summary>`$registryPath = "HKLM:\SOFTWARE\FSLogix\Profiles"`<br/><br/>`$ccdLocationsValue = "type=smb,connectionString=<\Location1\Folder1>;type=smb,connectionString=<\Location2\folder2>"`<br/><br/>`$enabledValue = 1`<br/><br/>`if (!(Test-Path -Path "$registryPath\CCDLocations")) {New-ItemProperty -Path $registryPath -Name "CCDLocations" -Value $ccdLocationsValue -PropertyType MultiString}`<br/><br/>`if (!(Test-Path -Path "$registryPath\Enabled")) {New-ItemProperty -Path $registryPath -Name "Enabled" -Value $enabledValue -PropertyType DWORD}`<br/><br/>e.g.\Cloud Cache for SMB:<br/><img src="https://i.imgur.com/t0pmjM1.png"></details><details><summary>Cloud Cache for Office Container(reg)</summary>`HKLM\SOFTWARE\Policies\FSLogix\ODFC` & same thing logic registries that the cloud cache for SMB</details><details><summary>cfg Profile containers</summary>`# 0: no deletion`<br/>`1: delete local profile if exists and matches the profile being loaded from VHD`<br/><br/>`new-itemProperty "hklm:\software\fsLogix\profiles" -name DeleteLocalProfileWhenVHDShouldApply -value 1 -propertyType dword`<br/><br/>`# 1: the SID folder is created as "%username%%sid%" instead of the default "%sid%%username%"`<br/><br/>`New-ItemProperty  "HKLM:\SOFTWARE\FSLogix\Profiles" -Name "FlipFlopProfileDirectoryName" -Value 1 -PropertyType DWord`<br/><br/>`# 1:  Profile Container loads FRXShell if there's a failure attaching to, or using an existing profile VHD(X)`<br/>`# The user receives the FRXShell prompt - default prompt to call support, and the users only option will be to sign out`<br/><br/>`New-ItemProperty  "HKLM:\SOFTWARE\FSLogix\Profiles" -Name "PreventLoginWithFailure" -Value 1 -PropertyType DWord`<br/><br/>`# 1: Profile Container loads FRXShell if it's determined a temp profile has been created. The user receives the FRXShell prompt - default prompt to call support, and the users only option will be to sign out`<br/><br/>`New-ItemProperty  "HKLM:\SOFTWARE\FSLogix\Profiles" -Name "PreventLoginWithTempProfile" -Value 1 -PropertyType DWord`</details>|
|21|Troubleshoot:<details><summary>app-issues-user-input-delay(Perfmon)</summary>`reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v "EnableLagCounter" /t REG_DWORD /d 0x1 /f`<br/><br/>performanceMonitor_addCounters:<br/><img src="https://i.imgur.com/V7QieXk.png"><br/>max session input delay (ms):<br/><img src="https://i.imgur.com/Pc44xUm.png"><br/>max process input delay:<br/><img src="https://i.imgur.com/2L55cgR.png"><br/>e.g.:if the Calculator app is running in a Session ID 1, you'll see `1:4232 <Calculator.exe`<br/>max prcess input delay (ms) for Calculator.exe<br/><img src="https://i.imgur.com/26MWww0.png"><br/>the Report if perfromance for an app is degraded<br/><img src="https://i.imgur.com/p0hLYfO.png"></details>||
